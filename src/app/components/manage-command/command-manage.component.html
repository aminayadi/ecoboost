<p-toast></p-toast>
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>


<p-dialog header="Add New Command" modal="true" [(visible)]="displayNewCommand"
	[style]="{width: '80vw',height: '30vw'}">
	<form [formGroup]="addNewRequestStockForm" (ngSubmit)="onSubmitaddNewRequestStockForm()" class="row g-3">
		<div class="col-6">
			<label for="listOfProducts" class="form-label">Product</label>
			<p-dropdown id="listOfProducts" formControlName="selectedProduct" [options]="availableProducts"
				optionLabel="name" [style]="{'width':'100%'}" placeholder="Select a Product">
 

			</p-dropdown>

		</div>

		<div class="col-6">
			<label for="inputAddress" class="form-label">stockQuantityInCarton</label>
			<input type="text" class="form-control" id="stockQuantityInCarton" formControlName="stockQuantityInCarton">
		</div>
		<div class="col-6">
			<label for="lastName" class="form-label">stockQuantitySingle</label>
			<input type="text" class="form-control" id="stockQuantitySingle" formControlName="stockQuantitySingle">
		</div>


		<div class="col-12">
			<button type="submit" class="btn btn-primary">Save</button>
		</div>

	</form>
</p-dialog>
<p-dialog header="Associate Stock to a delivery" modal="true" [(visible)]="showAssociateToDelivery"
	[style]="{width: '35vw',height: '25vw'}">
	<div class="col-6">
		<p-dropdown id="listOfDeliveries" [(ngModel)]="selectedDelivery" [options]="listOfDeliveries" optionLabel="email"
			[style]="{'width':'100%'}" placeholder="Select a Delivery">
 


		</p-dropdown>
	</div> 
	<div class="col-6">
		 <p-button label="Select" (onClick)="onSelectAssocateWithDelivery()" class="btn btn-primary"> </p-button>
	</div>
</p-dialog>
<div class="container">
	<div class="row">
    <div class="col-sm-10"  >
		<p-table #dtRequestStock [value]="commandDTOs" dataKey="id" [rows]="10" [loading]="loadingTable" [rowHover]="true"
			styleClass="p-datatable-gridlines" [paginator]="true" (onPage)="onPage($event)" [globalFilterFields]="['product'  ]"
			responsiveLayout="scroll">
			<ng-template pTemplate="caption">
				<div class="flex justify-content-between flex-column sm:flex-row">
					<div class="container">
						<div class="row">
							<div class="col">
								<button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
									(click)="clear(dt1)"></button>
		
							</div>
							<div class="col" *ngIf="userType.toString()=='Agent'">
								<button pButton label="New Command" [(visible)]="displayNewRequestStockButton"
									class="p-button-outlined mb-2" (click)="displayNewCommand=true"
									icon="pi pi-filter-slash"></button>
		
							</div>
		
						</div>
					</div>
					<span class="p-input-icon-left mb-2">
						<i class="pi pi-search"></i>
						<input pInputText type="text" #filter (input)="dt1.filterGlobal($event.target.value, 'contains')"
							placeholder="Search Keyword" class="w-full" />
					</span>
				</div>
		
			</ng-template>
			<ng-template pTemplate="header">
				<tr>
					<th>
						<div class="flex justify-content-between align-items-center">
							product
							<p-columnFilter type="text" field="name" display="menu" placeholder="Search by product">
							</p-columnFilter>
						</div>
					</th>
		
					<th>
						<div class="flex justify-content-between align-items-center">
							stockQuantityInCarton
							<p-columnFilter type="text" field="name" display="menu">
							</p-columnFilter>
						</div>
					</th>
					<th>
						<div class="flex justify-content-between align-items-center">
							stockQuantitySingle
							<p-columnFilter type="text" field="name" display="menu">
							</p-columnFilter>
						</div>
					</th>
					<th>
						<div class="flex justify-content-between align-items-center">
							Status
		
						</div>
					</th>
					<th *ngIf="userType.toString()=='Admin'">
						<div class="flex justify-content-between align-items-center">
							Agent
		
						</div>
					</th>
					<th *ngIf="userType.toString()=='Admin'">
						<div class="flex justify-content-between align-items-center">
							Delivery
		
						</div>
					</th>
					<th *ngIf="userType.toString()=='Admin'">
						<div class="flex justify-content-between align-items-center">
							Associate to a Delivery
						</div>
					</th>
					 
					<th *ngIf="userType.toString()=='Delivery'">
						<div class="flex justify-content-between align-items-center">
							Pick up command
						</div>
					</th>
					<th *ngIf="userType.toString()=='Admin'">
						<div class="flex justify-content-between align-items-center">
							Confirm Command
						</div>
					</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-commandDTO>
				<tr>
					<td style="min-width: 12rem;">
		
						{{commandDTO.productDTO.name}}
		
		
					</td>
		
					<td style="min-width: 12rem;">
		
						{{commandDTO.stockQuantityInCarton}}
		
					</td>
					<td style="min-width: 12rem;">
		
						{{commandDTO.stockQuantitySingle}}
		
					</td>
		
					<td style="min-width: 12rem;">
		
						{{commandDTO.commandStatus}}
		
					</td>
					<td *ngIf="userType.toString()=='Admin'" style="min-width: 12rem;">
		
						{{commandDTO.relatedAgent.email}}
		
					</td>
					<td *ngIf="userType.toString()=='Admin'" style="min-width: 12rem;">
		
						{{commandDTO.relatedDelivery== null?'': commandDTO.relatedDelivery.email}}
		
					</td>
					<td *ngIf="userType.toString()=='Admin'" style="min-width: 12rem;">
						<button pButton type="button" icon="pi pi-pencil" (click)="onClickAssciateWithDelivery(commandDTO)" [disabled]="this.checkDisableButton('onClickAssciateWithDelivery',commandDTO)" 
							class="p-button-rounded p-button-text"></button>
		
					</td>
					<td *ngIf="userType.toString()=='Delivery'" style="min-width: 12rem;">
						<button pButton type="button" icon="pi pi-pencil"   (click)="pickUpCommandByDelivery(commandDTO)" 
							class="p-button-rounded p-button-text"></button>
		
					</td>
					<td *ngIf="userType.toString()=='Admin'" style="min-width: 12rem;">
						<button pButton type="button" icon="pi pi-pencil" [disabled]="this.checkDisableButton('validateCommandByAdmin',commandDTO)"  (click)="validateCommandByAdmin(commandDTO)"
							class="p-button-rounded p-button-text"></button>
		
					</td>
				</tr>
			</ng-template>
			<ng-template pTemplate="emptymessage">
				<tr>
					<td colspan="7">No Stocks found.</td>
				</tr>
			</ng-template>
			<ng-template pTemplate="loadingbody">
				<tr>
					<td colspan="7">Loading Stocks data. Please wait.</td>
				</tr>
			</ng-template>
		</p-table></div>
		<div class="col" ><user-info></user-info></div>
 
    
</div></div>